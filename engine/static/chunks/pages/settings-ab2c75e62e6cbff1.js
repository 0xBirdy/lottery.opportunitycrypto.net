(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[662],{52837:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/settings",function(){return t(25609)}])},25609:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return ee}});var r=t(47568),a=t(26042),o=t(34051),s=t.n(o),i=t(85893),c=t(214),l=t.n(c),d=t(44423),u=t(11163),h=[{id:"index",title:"Home",link:"index"},{id:"settings",title:"Settings",link:"settings",adminOnly:!0}],f=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,u.useRouter)();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("nav",{className:"".concat(l().mainNav," headerNavMenu"),children:h.map((function(t){return t.adminOnly&&!n?null:(0,i.jsx)("a",{className:e===t.id?"".concat(l().active," headerNavActive"):"",href:(0,d.R)(t.link),children:t.title},t.id)}))}),(0,i.jsx)("div",{className:l().mainNavSeperator})]})},m=t(67294),v=t(64914),x=t.n(v),g=t(3283),j=t.n(g),p=t(64262),b=function(e,n){return new Promise((function(t,r){var a=(0,p.T_)(n);if(a)try{var o=new(new(j())(a.rpcUrls[0]).eth.Contract)(x(),e);o.methods.decimals().call().then((function(a){o.methods.symbol().call().then((function(s){o.methods.name().call().then((function(r){t({address:e,chainId:n,decimals:a,symbol:s,name:r})})).catch((function(e){r(e)}))})).catch((function(e){r(e)}))})).catch((function(e){r(e)}))}catch(s){r(s)}else r("NOT_SUPPORTED_CHAIN")}))},y=t(56767),w=t(44431),k=t.n(w),N=function(e){return new Promise((function(n,t){var a=e.activeWeb3,o=e.tokenAddress,i=e.onTrx||function(){},c=e.onSuccess||function(){},l=e.onError||function(){},d=e.onFinally||function(){};a.eth.getAccounts().then(function(){var e=(0,r.Z)(s().mark((function e(n){var r,u,h,f,m,v;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n.length>0)){e.next=13;break}return r=n[0],u=new a.eth.Contract(y.Mt),h={from:r,gas:"0"},f=[o],e.next=7,u.deploy({arguments:f,data:y.aT.eF.Ry}).estimateGas(h);case 7:m=e.sent,v=new w.BigNumber(new w.BigNumber(m).multipliedBy(1.05).toFixed(0)).toString(16),h.gas="0x"+v,u.deploy({data:"0x"+y.aT.eF.Ry,arguments:f}).send(h).on("transactionHash",(function(e){console.log("transaction hash:",e),i(e)})).on("error",(function(e){console.log("transaction error:",e),l(e)})).on("receipt",(function(e){console.log("transaction receipt:",e),c(e.contractAddress)})).then((function(){d()})),e.next=14;break;case 13:t("NO_ACTIVE_ACCOUNT");case 14:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.log(">>> deployLottery",e),t(e)}))}))};function C(e){var n=e.type,t=e.label,r=e.value,a=e.onChange,o=e.buttons,s=e.values,c=e.placeholder,d=e.hasError,u=e.errorText,h=n;if("address"===n)h="text";return(0,i.jsxs)("div",{className:"".concat(l().adminFormInputHolder," ").concat(d?l().hasError:""),children:["list"===n?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("label",{children:[t,": (",r,")"]}),(0,i.jsxs)("div",{children:[d&&u&&(0,i.jsx)("span",{className:l().hasError,children:u}),(0,i.jsx)("select",{value:r,onChange:function(e){return a(e.target.value)},children:s.map((function(e){return(0,i.jsx)("option",{value:e.id,children:e.title},e.id)}))})]})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("label",{children:[t,":"]}),d&&u&&(0,i.jsx)("span",{className:l().hasError,children:u}),(0,i.jsx)("div",{children:"number"===h?(0,i.jsx)("input",{min:(null===e||void 0===e?void 0:e.minValue)||void 0,max:(null===e||void 0===e?void 0:e.maxValue)||void 0,type:"number",placeholder:c||"",value:r,onChange:function(e){a(e.target.value)}}):(0,i.jsx)("input",{type:h,placeholder:c||"",value:r,onChange:function(e){return a(e.target.value)}})})]}),o&&(0,i.jsx)("div",{className:l().adminFormButtonsHolder,children:o})]})}var S=function(){var e=Object.keys(p.w5).map((function(e){return{id:p.w5[e].networkVersion,title:p.w5[e].chainName}}));return e.unshift({id:0,title:"Select Blockchain"}),e}();function F(e){e.setDoReloadStorage;var n=e.saveStorageConfig,t=e.openConfirmWindow,r=e.addNotify,a=e.getActiveChain,o=e.storageData,s=(0,m.useState)(null===o||void 0===o?void 0:o.chainId),c=s[0],d=s[1],u=(0,m.useState)(null===o||void 0===o?void 0:o.lotteryAddress),h=u[0],f=u[1],v=(0,m.useState)(null===o||void 0===o?void 0:o.tokenAddress),x=v[0],g=v[1],j=(0,m.useState)(!1),y=j[0],w=(j[1],(0,m.useState)(!1)),k=(w[0],w[1],(0,m.useState)(!1)),F=k[0],I=k[1],A=(0,m.useState)(!1),R=A[0],T=A[1],D=(0,m.useState)(null===o||void 0===o?void 0:o.tokenInfo),_=D[0],E=D[1],W=(0,m.useState)(!1),L=W[0],B=W[1],Z=(0,m.useState)(void 0!==o.tokenInfo.address),O=Z[0],P=Z[1],M=(0,m.useState)(!1),U=M[0],V=M[1],H=function(){t({title:"Save to storage",message:"Save changes to storage config?",onConfirm:function(){V(!0),n({onBegin:function(){r("Confirm transaction")},onReady:function(){V(!1),r("Changed saved","success")},onError:function(e){V(!1),r("Fail save changes. ".concat(e.message?e.message:""),"error")},newData:{chainId:c,tokenAddress:x,lotteryAddress:h,tokenInfo:_}})}})},K=function(){c?(P(!1),B(!1),E({}),r("Fetching token info"),b(x,c).then((function(e){B(!1),E(e),P(!0),r("Token info fetched","success")})).catch((function(e){r("Fail fetch token info. ".concat(e.message?e.message:""),"error"),B(!1)}))):r("Fail fetch. Select work chain first","error")},G=function(){},J=function(){T(!1)},Y=function(){T(!0)},q=(0,m.useState)(!1),z=(q[0],q[1],function(){if(!c)return r("Fail. Select work chain first","error");if(!O)return r("Fail. Fetch token info first","error");var e=a(),n=e.activeChainId,o=e.activeWeb3,s=(0,p.T_)(n);c&&O&&x&&t({title:"Deploying Lottery contract",message:"Deploy Lottery contract at ".concat(s.chainName," (").concat(n,")?"),onConfirm:function(){I(!0),r("Deploying lottery. Confrirm transaction"),N({activeWeb3:o,tokenAddress:x,onTrx:function(e){r("Lottery contract deploy TX ".concat(e,"..."),"success")},onSuccess:function(e){try{r("Lottery contract deployed. Now save settings","success"),f(e),I(!1),T(!1)}catch(n){console.log(">>> onSuccess error",n)}},onError:function(e){r("Fail deploy Lottery contract. ".concat(e.message?e.message:""),"error"),I(!1),console.log(e)}}).catch((function(e){I(!1),r("Fail deploy Lottery contract. ".concat(e.message?e.message:""),"error")}))}})});return{render:function(){return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{className:l().adminForm,children:[C({label:"Work blockchain ID",type:"list",values:S,value:c,onChange:d}),R?(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{className:l().subFormInfo,children:[(0,i.jsx)("h3",{children:"Deploy new Lottery contract options"}),(0,i.jsxs)("div",{className:l().subForm,children:[C({label:"Lottery token",type:"address",value:x,onChange:g,placeholder:"Ender address of lottery ERC20 token",buttons:(0,i.jsx)("button",{disabled:L,onClick:K,children:L?"Fetching":"Fetch token info"})}),O&&_&&_.address&&(0,i.jsxs)("div",{className:l().infoTable,children:[(0,i.jsx)("h3",{children:"Token info"}),(0,i.jsxs)("div",{className:l().infoRow,children:[(0,i.jsx)("label",{children:"Symbol:"}),(0,i.jsx)("span",{children:(0,i.jsx)("b",{children:_.symbol})})]}),(0,i.jsxs)("div",{className:l().infoRow,children:[(0,i.jsx)("label",{children:"Name:"}),(0,i.jsx)("span",{children:(0,i.jsx)("b",{children:_.name})})]}),(0,i.jsxs)("div",{className:l().infoRow,children:[(0,i.jsx)("label",{children:"Decimals:"}),(0,i.jsx)("span",{children:(0,i.jsx)("b",{children:_.decimals})})]})]})]}),(0,i.jsxs)("div",{className:l().actionsRow,children:[(0,i.jsx)("button",{disabled:F,onClick:z,children:F?"Deploying":"Deploy Lottery contract"}),(0,i.jsx)("button",{disabled:F,onClick:J,children:"Cancel"})]})]})}):(0,i.jsxs)(i.Fragment,{children:[C({label:"Lottery contract",type:"address",value:h,onChange:f,placeholder:"Enter address of lottery contract",buttons:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("button",{disabled:y||F,className:l().secondaryButton,onClick:G,children:y?"Fetching info":"Fetch info"}),(0,i.jsx)("button",{disabled:y||F,className:l().secondaryButton,onClick:Y,children:"Deploy new"})]})}),O&&_&&_.address&&(0,i.jsxs)("div",{className:l().subFormInfo,children:[(0,i.jsx)("h3",{children:"Token info"}),(0,i.jsxs)("div",{className:l().subForm,children:[(0,i.jsxs)("div",{className:l().infoRow,children:[(0,i.jsx)("label",{children:"Address:"}),(0,i.jsx)("span",{children:(0,i.jsx)("b",{children:_.address})})]}),(0,i.jsxs)("div",{className:l().infoRow,children:[(0,i.jsx)("label",{children:"Symbol:"}),(0,i.jsx)("span",{children:(0,i.jsx)("b",{children:_.symbol})})]}),(0,i.jsxs)("div",{className:l().infoRow,children:[(0,i.jsx)("label",{children:"Name:"}),(0,i.jsx)("span",{children:(0,i.jsx)("b",{children:_.name})})]}),(0,i.jsxs)("div",{className:l().infoRow,children:[(0,i.jsx)("label",{children:"Decimals:"}),(0,i.jsx)("span",{children:(0,i.jsx)("b",{children:_.decimals})})]})]})]})]}),(0,i.jsx)("div",{children:(0,i.jsx)("button",{disabled:U,onClick:H,className:l().secondaryButton,children:U?"Saving...":"Save to storage config"})})]})})}}}var I=t(14924),A=t(69396),R=t(99603),T=t(59417);function D(e){var n=e.icon,t="fa-".concat(n).replace(/(?:^\w|[A-Z]|\b\w)/g,(function(e,n){return 0===n?e.toLowerCase():e.toUpperCase()})).replace(/\s+/g,"").replaceAll("-","");return(0,i.jsx)(R.G,{icon:T[t]})}function _(e){var n=(0,a.Z)({href:"",title:"",icon:"up-right-from-square",onClick:function(){}},e),t=n.href,r=n.title,o=n.icon,s=n.onClick,c=n.target,d=n.disabled,u={className:"".concat(l().iconButton," ").concat(d?l().iconButtonDisabled:""),alt:r,title:r};return t&&(u.href=t),c&&(u.target=c),(0,i.jsx)("a",(0,A.Z)((0,a.Z)({},u),{onClick:function(){d||s()},children:(0,i.jsx)(D,{icon:o})}))}var E=t(88765);function W(e){e.setDoReloadStorage;var n=e.saveStorageConfig,t=e.openConfirmWindow,r=e.addNotify,o=e.getActiveChain,s=e.storageData,c=(e.getStorageData,(0,m.useState)(0)),d=c[0],u=c[1],h=(0,m.useState)(0),f=h[0],v=h[1],x=(0,m.useState)(0),g=x[0],j=x[1],p=(0,m.useState)(!1),b=p[0],y=p[1],w=(0,m.useState)(s.ticketPrice),k=w[0],N=w[1],C=(0,m.useState)(!1),S=C[0],F=C[1],R=(0,m.useState)(!1),T=(R[0],R[1]);(0,m.useEffect)((function(){s.lotteryAddress&&s.chainId&&(0,E.Z)({isCall:!0,chainId:s.chainId,contractAddress:s.lotteryAddress,method:"numbersCount",args:[]}).then((function(e){z(e)}))}),[s]);var W=(0,m.useState)(s.matchRules||{match_1:39.2,match_2:58.8,match_3:6.125,match_4:12.25,match_5:24.5,match_6:49}),L=W[0],B=W[1],Z=(0,m.useState)([1,2,3,4,5,6]),O=Z[0],P=Z[1],M=(0,m.useState)(!1),U=M[0],V=M[1],H=(0,m.useState)(!1),K=H[0],G=H[1],J=(0,m.useState)(s.burn),Y=J[0],q=J[1],z=function(e){e<2&&(e=2),e>6&&(e=6),j(e),P((function(n){return[1,2,3,4,5,6].filter((function(n){return n<=parseInt(e)}))}))};(0,m.useEffect)((function(){!function(){for(var e=0,n=1;n<=6;n++)n<=g&&(e+=L["match_".concat(n)]);u(e),v(100-e)}()}),[g,L]);var X=function(){t({title:"Save changes to Lottery",message:"Save new count of balls?",onConfirm:function(){V(!0);var e=o().activeWeb3;r("Confirm transaction"),(0,E.Z)({activeWeb3:e,contractAddress:s.lotteryAddress,method:"setNumbersCount",args:[g]}).then((function(e){V(!1),y(!1),r("Changes saved","success")})).catch((function(e){V(!1),r("Fail save balls count. ".concat(e.message?e.message:""),"error")}))}})},Q=function(){t({title:"Save match rules",message:"Save winning balls match rules, burn amount and ticket price to storage config?",onConfirm:function(){G(!0),r("Saving winning rules..."),n({onBegin:function(){r("Confirm transaction")},onReady:function(){G(!1),r("Changed saved","success")},onError:function(e){G(!1),r("Fail save changes. ".concat(e.message?e.message:""),"error")},newData:{matchRules:L,burn:Y,balls:g,ticketPrice:k}})}})};return{render:function(){var e;return s.lotteryAddress?(0,i.jsx)("div",{className:l().adminForm,children:(0,i.jsxs)("div",{className:l().subFormInfo,children:[(0,i.jsx)("h3",{children:"Lottery rules"}),(0,i.jsx)("div",{className:l().subForm,children:(0,i.jsxs)("div",{className:l().infoRow,children:[(0,i.jsx)("label",{children:"Balls count:"}),(0,i.jsx)("div",{children:(0,i.jsxs)("div",{children:[(0,i.jsx)("input",{type:"number",min:"2",max:"6",step:"1",value:g,onChange:function(e){z(e.target.value)}}),_({title:"Save to contract",onClick:X,disabled:U,icon:"save"})]})})]})}),(0,i.jsx)("h3",{children:"Distribution of prizes %"}),(0,i.jsxs)("div",{className:l().subForm,children:[(0,i.jsx)("h4",{children:"Distribute the winning percentage based on the number of matched balls"}),O.map((function(e){return(0,i.jsxs)("div",{className:l().infoRow,children:[(0,i.jsxs)("label",{children:["Match ",e," ball:"]}),(0,i.jsx)("div",{children:(0,i.jsxs)("div",{children:[(0,i.jsx)("input",{type:"number",min:"0",max:"100",step:"0.01",value:L["match_".concat(e)],onChange:function(n){var t=0;try{t=parseFloat(n.target.value)}catch(r){t=0}t<0&&(t=0),t>100&&(t=100),B((function(n){return(0,A.Z)((0,a.Z)({},n),(0,I.Z)({},"match_".concat(e),t))}))}}),(0,i.jsx)("strong",{children:"%"}),(0,i.jsxs)("a",{className:l().buttonWithIcon,onClick:function(){var n;n=e,B((function(e){return(0,A.Z)((0,a.Z)({},e),(0,I.Z)({},"match_".concat(n),e["match_".concat(n)]+f))}))},children:[(0,i.jsx)(D,{icon:"arrow-left"}),"Equalize the remainder"]})]})})]},e)})),(0,i.jsxs)("div",{className:l().infoRow,children:[(0,i.jsx)("label",{children:"Burn (From 2 to 30):"}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("input",{type:"number",min:"2",max:"30",value:Y,onChange:function(e){q(e.target.value)}}),(0,i.jsx)("strong",{children:"%"})]}),(0,i.jsx)("div",{children:"How many percents of the band in a round will be burned"})]})]}),(0,i.jsxs)("div",{className:l().infoRow,children:[(0,i.jsx)("label",{children:"Sum:"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("b",{children:d}),(0,i.jsx)("strong",{children:"%"})]})]}),(0,i.jsxs)("div",{className:l().infoRow,children:[(0,i.jsx)("label",{children:"Undistributed:"}),(0,i.jsx)("div",{children:0!==f?(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("b",{className:l().hasError,children:[f," %"]})}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("b",{children:f}),(0,i.jsx)("strong",{children:"%"})]})})]}),(0,i.jsxs)("div",{className:l().infoRow,children:[(0,i.jsx)("label",{children:"Ticket price:"}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("input",{type:"number",step:"0.1",min:"0",value:k,onChange:function(e){!function(n){F(!1);try{(n=parseFloat(n))<0&&F(!0),n>50&&F(!0)}catch(e){F(!0)}N(n),T(s.ticketPrice!==n)}(e.target.value)}}),(0,i.jsx)("strong",{children:null===s||void 0===s||null===(e=s.tokenInfo)||void 0===e?void 0:e.symbol})]}),S&&(0,i.jsx)("div",{className:l().hasError,children:(0,i.jsx)("strong",{children:"Price must be between 0.00000000001 and 50"})})]})]}),(0,i.jsxs)("div",{className:l().actionsRow,children:[b&&(0,i.jsx)("strong",{className:l().hasError,children:"Save balls count first!"}),(0,i.jsx)("button",{disabled:K,onClick:Q,children:K?"Saving...":"Save match rules, burn amount and ticket price"})]})]})]})}):(0,i.jsxs)("div",{className:l().errorBlock,children:[(0,i.jsx)("span",{children:"Section not accessible"}),(0,i.jsx)("span",{children:"Deploy and save the lottery contract first"})]})}}}var L=function(e){return new Promise(function(){var n=(0,r.Z)(s().mark((function n(t,r){var a,o,i,c,l,d,u,h,f,m;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=e.chainId,o=e.contractAddress,!(i=(0,p.T_)(a))){n.next=27;break}return n.prev=3,c=new(j())(i.rpcUrls[0]),l=new c.eth.Contract(y.Mt,o),n.next=8,l.methods.owner().call();case 8:return d=n.sent,n.next=11,l.methods.operatorAddress().call();case 11:return u=n.sent,n.next=14,l.methods.treasuryAddress().call();case 14:return h=n.sent,n.next=17,l.methods.viewCurrentLotteryId().call();case 17:return f=n.sent,n.next=20,l.methods.viewLottery(f).call();case 20:m=n.sent,t({chainId:a,contractAddress:o,owner:d,operator:u,treasury:h,currentLotteryInfo:m,currentLotteryNumber:f}),n.next=27;break;case 24:n.prev=24,n.t0=n.catch(3),r(n.t0);case 27:case"end":return n.stop()}}),n,null,[[3,24]])})));return function(e,t){return n.apply(this,arguments)}}())},B=function(e,n){var t=Number(n-e),r=Math.floor(t/3600),a=Math.floor(t%3600/60),o=Math.floor(t%3600%60);return(r>0?r+(1==r?" hour, ":" hours, "):"")+(a>0?a+(1==a?" minute, ":" minutes, "):"")+(o>0?o+(1==o?" second":" seconds"):"")},Z=t(73848),O=function(e){var n=e.ownerAddress,t=e.tokenAddress,r=e.chainId,a=e.approveFor;return new Promise((function(e,o){var s=(0,p.T_)(r);if(s)try{new(new(j())(s.rpcUrls[0]).eth.Contract)(x(),t).methods.allowance(n,a).call().then((function(n){e(n)})).catch((function(e){o(e)}))}catch(i){o(i)}else o("NOT_SUPPORTED_CHAIN")}))},P=t(10797),M=t(53419),U=function(e){return new Promise((function(n,t){var a=e.activeWeb3,o=(e.chainId,e.tokenAddress),i=e.approveFor,c=e.weiAmount,l=e.onTrx||function(){},d=e.onSuccess||function(){},u=e.onError||function(){},h=e.onFinally||function(){};a.eth.getAccounts().then(function(){var e=(0,r.Z)(s().mark((function e(r){var f,m,v,g;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r.length>0)){e.next=10;break}return m=r[0],v=new a.eth.Contract(x(),o),e.next=6,(0,M.A)(m,v,"approve",[i,c]);case 6:g=e.sent,(f=v.methods).approve.apply(f,(0,P.Z)([i,c])).send(g).on("transactionHash",(function(e){console.log("transaction hash:",e),l(e)})).on("error",(function(e){console.log("transaction error:",e),u(e),t(e)})).on("receipt",(function(e){console.log("transaction receipt:",e),d(e)})).then((function(e){n(e),h(e)})),e.next=11;break;case 10:t("NO_ACTIVE_ACCOUNT");case 11:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.log(">>> approveToken",e),t(e)}))}))},V=t(35553),H=t(72023),K=t.n(H),G=function(){for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=n.length,r=0;r<128;r++)e+=n.charAt(Math.floor(Math.random()*t));return e};function J(e){e.setDoReloadStorage,e.saveStorageConfig;var n=e.openConfirmWindow,t=e.addNotify,r=e.getActiveChain,a=e.storageData,o=(e.getStorageData,(0,m.useState)(!1)),s=o[0],c=o[1],d=(0,m.useState)(!1),u=d[0],h=d[1],f=(0,m.useState)(!1),v=f[0],x=f[1],g=(0,m.useState)(!1),j=g[0],p=g[1],b=(0,m.useState)(!1),y=b[0],w=b[1],N=(0,m.useState)(""),C=N[0],S=N[1],F=(0,m.useState)(0),I=F[0],A=F[1],R=(0,m.useState)(!1),T=R[0],_=R[1],W=(0,m.useState)(!1),P=W[0],M=W[1],H=(0,m.useState)(!1),J=H[0],Y=H[1],q=(0,m.useState)(!1),z=q[0],X=q[1];(0,m.useEffect)((function(){if(s&&u){var e=new Date("".concat(s," ").concat(u)).getTime()/1e3,n=B((0,Z.K)(),e);x(n)}}),[s,u]);var Q=function(){a.chainId&&a.lotteryAddress&&(t("Fetching lottery status"),L({chainId:a.chainId,contractAddress:a.lotteryAddress}).then((function(e){t("Lottery status fetched","success"),p(e),w(e.currentLotteryInfo)})))};(0,m.useEffect)((function(){X(!1);var e=new(k())(y.amountCollectedInCake).div(new(k())(10).pow(a.tokenInfo.decimals)).toNumber();A(e),_(new Date(1e3*parseInt(y.startTime,10)).toString()),M(new Date(1e3*parseInt(y.endTime,10)).toString()),Y(B((0,Z.K)(),parseInt(y.endTime,10)+60)),"1"===y.status&&parseInt(y.endTime,10)-(0,Z.K)()<0?(S("lottery_round"),X(!0)):"1"!==j.currentLotteryNumber&&"1"===y.status?S("lottery_round"):"2"===y.status?S("lottery_draw"):"3"===y.status&&S("lottery_start")}),[y]),(0,m.useEffect)((function(){Q()}),[a]);var $=(0,m.useState)(!1),ee=$[0],ne=$[1],te=function(){var e;return void 0===(null===a||void 0===a||null===(e=a.tokenInfo)||void 0===e?void 0:e.decimals)?t("Fail. No information about token. Fetch them first and return","error"):(null===a||void 0===a?void 0:a.ticketPrice)?(null===a||void 0===a?void 0:a.burn)?s&&u?void n({title:"New round",message:"Start new lottery round?",onConfirm:function(){var e=new(k())(a.ticketPrice).multipliedBy(Math.pow(10,a.tokenInfo.decimals)).toFixed(),n=parseInt(100*a.burn,10),o=[1,2,3,4,5,6].map((function(e){return e<=a.balls?parseInt(100*parseFloat(a.matchRules["match_".concat(e)]),10):0})),i=new Date("".concat(s," ").concat(u)).getTime()/1e3;t("Starting new lottery round..."),ne(!0);var c=r().activeWeb3;(0,E.Z)({activeWeb3:c,contractAddress:a.lotteryAddress,method:"startLottery",args:[i,e,2e3,o,n]}).then((function(e){ne(!1),Q(),t("New lottery round started","success")})).catch((function(e){ne(!1),t("Fail start new lottery round. ".concat(e.message?e.message:""),"error")}))}}):t("Fail. Enter date of lottery round end","error"):t("Fail. Burn amount not setted","error"):t("Fail. Ticket price not setted.","error")},re=(0,m.useState)(0),ae=re[0],oe=re[1],se=(0,m.useState)(!1),ie=(se[0],se[1]),ce=function(){n({title:"Inject lotery bank amount",message:"Add ".concat(ae," ").concat(null===a||void 0===a?void 0:a.tokenInfo.symbol," to the pot of the lottery round?"),onConfirm:function(){ie(!0);var e,n,o=(e=ae,V.vz("".concat(e),n)),s=r();t("Inject bank. Check allovance"),O({ownerAddress:s.activeAccount,tokenAddress:null===a||void 0===a?void 0:a.tokenAddress,chainId:null===a||void 0===a?void 0:a.chainId,approveFor:null===a||void 0===a?void 0:a.lotteryAddress}).then((function(e){var n=function(){t("Injecting round bank. Confirm transaction"),(0,E.Z)({activeWeb3:s.activeWeb3,contractAddress:a.lotteryAddress,method:"injectFunds",args:[j.currentLotteryNumber,o]}).then((function(e){ie(!1),Q(),t("The bank or round was replenished","success")})).catch((function(e){ie(!1),t("Fail inject funds. ".concat(e.message?e.message:""),"error")}))};new(k())("".concat(o)).isGreaterThan(e)?(t("Inject bank. Need approve"),U({activeWeb3:s.activeWeb3,chainId:null===a||void 0===a?void 0:a.chainId,tokenAddress:null===a||void 0===a?void 0:a.tokenAddress,approveFor:null===a||void 0===a?void 0:a.lotteryAddress,weiAmount:o}).then((function(e){n()})).catch((function(e){ie(!1),t("Fail approve for inject round bank. ".concat(e.message?e.message:""),"error")}))):n()})).catch((function(e){ie(!1),t("Fail inject round bank. ".concat(e.message?e.message:""),"error")}))}})},le=(0,m.useState)(!1),de=le[0],ue=le[1],he=function(){var e=r();ue(!0),t("Closing lottery round. Confirm transaction"),(0,E.Z)({activeWeb3:e.activeWeb3,contractAddress:a.lotteryAddress,method:"closeLottery",args:[j.currentLotteryNumber]}).then((function(e){ue(!1),Q(),t("Lottery round was closed","success")})).catch((function(e){ue(!1),t("Fail close lottery round. ".concat(e.message?e.message:""),"error")}))},fe=(0,m.useState)(G()),me=fe[0],ve=fe[1],xe=function(){ve(G())},ge=(0,m.useState)(!1),je=ge[0],pe=ge[1],be=function(){var e=G(),n=K()("".concat(e).concat(me));pe(!0),t("Drawing winning numbers. Confirm transaction");var o=r();(0,E.Z)({activeWeb3:o.activeWeb3,contractAddress:a.lotteryAddress,method:"drawFinalNumberAndMakeLotteryClaimable",args:[j.currentLotteryNumber,"0x".concat(n),!0]}).then((function(e){pe(!1),Q(),t("Winning numbers drawed!","success")})).catch((function(e){pe(!1),t("Fail draw winning numbers. ".concat(e.message?e.message:""),"error")}))};return{render:function(){var e,n;return a.lotteryAddress?(0,i.jsxs)("div",{className:l().adminForm,children:["lottery_start"===C&&(0,i.jsxs)("div",{className:l().subFormInfo,children:[(0,i.jsx)("h3",{children:"Start new lottery round"}),(0,i.jsxs)("div",{className:l().subForm,children:[(0,i.jsxs)("div",{className:l().infoRow,children:[(0,i.jsx)("label",{children:"Round end in:"}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("input",{type:"date",value:s,onChange:function(e){c(e.target.value)}}),(0,i.jsx)("input",{type:"time",value:u,onChange:function(e){h(e.target.value)}}),(0,i.jsx)("strong",{children:"(min 5 minutes, max 31 days)"})]}),v&&(0,i.jsx)("div",{children:(0,i.jsxs)("strong",{children:["Round length is ",v]})})]})]}),(0,i.jsx)("div",{className:l().actionsRow,children:(0,i.jsx)("button",{disabled:ee,onClick:te,children:ee?"Starting new lottery round...":"Start new round"})})]})]}),"lottery_round"===C&&(0,i.jsxs)("div",{className:l().subFormInfo,children:[(0,i.jsx)("h3",{children:"Lottery round is running now"}),(0,i.jsxs)("div",{className:l().subForm,children:[(0,i.jsxs)("div",{className:l().infoRow,children:[(0,i.jsx)("label",{children:"Round started:"}),(0,i.jsx)("div",{children:(0,i.jsx)("div",{children:(0,i.jsx)("strong",{children:T})})})]}),(0,i.jsxs)("div",{className:l().infoRow,children:[(0,i.jsx)("label",{children:"Round ends:"}),(0,i.jsx)("div",{children:(0,i.jsx)("div",{children:(0,i.jsx)("strong",{children:P})})})]}),(0,i.jsxs)("div",{className:l().infoRow,children:[(0,i.jsx)("label",{children:"Time left:"}),(0,i.jsx)("div",{children:z?(0,i.jsx)("div",{children:(0,i.jsx)("a",{className:l().buttonWithIcon,onClick:he,children:de?"Closing...":"Time is over. Click to close the round and proceed to calculating the winning combination"})}):(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:J}),(0,i.jsxs)("a",{className:l().buttonWithIcon,onClick:Q,children:[(0,i.jsx)(D,{icon:"refresh"}),"Fetch status"]})]})})]}),(0,i.jsxs)("div",{className:l().infoRow,children:[(0,i.jsx)("label",{children:"Round bank:"}),(0,i.jsx)("div",{children:(0,i.jsx)("div",{children:(0,i.jsxs)("strong",{children:[I," ",null===a||void 0===a||null===(e=a.tokenInfo)||void 0===e?void 0:e.symbol]})})})]}),(0,i.jsxs)("div",{className:l().infoRow,children:[(0,i.jsx)("label",{children:"Inject funds:"}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("input",{type:"number",min:"0",step:"0.01",value:ae,onChange:function(e){oe(e.target.value)}}),(0,i.jsx)("strong",{children:null===a||void 0===a||null===(n=a.tokenInfo)||void 0===n?void 0:n.symbol}),(0,i.jsxs)("a",{className:l().buttonWithIcon,onClick:ce,children:[(0,i.jsx)(D,{icon:"add"}),"Approve and add to round bank"]})]}),(0,i.jsx)("div",{children:(0,i.jsx)("strong",{children:"You can add some amount of tokens to bank of current lottery round"})})]})]})]})]}),"lottery_draw"===C&&(0,i.jsxs)("div",{className:l().subFormInfo,children:[(0,i.jsx)("h3",{children:"The lottery round is over. You need to calculate the winning combination"}),(0,i.jsxs)("div",{className:l().infoRow,children:[(0,i.jsx)("label",{children:"Uniq salt:"}),(0,i.jsx)("div",{children:(0,i.jsxs)("div",{children:[(0,i.jsx)("input",{type:"text",value:me,readOnly:!0}),(0,i.jsx)("a",{className:l().buttonWithIcon,onClick:xe,children:"Generate rand"})]})})]}),(0,i.jsx)("div",{className:l().actionsRow,children:(0,i.jsx)("button",{disabled:je,onClick:be,children:"Calculate winning numbers"})})]})]}):(0,i.jsxs)("div",{className:l().errorBlock,children:[(0,i.jsx)("span",{children:"Section not accessible"}),(0,i.jsx)("span",{children:"Deploy and save the lottery contract first"})]})}}}var Y=t(78967),q=t(34617),z=t(94360),X=t(84575),Q=function(e){return new Promise((function(n){window.setTimeout((function(){n()}),e)}))},$={main:"Main settings",gamerules:"Rules",rounds:"Rounds",texts:"Edit texts",design:"Design"},ee=(function(){var e=Object.keys(p.w5).map((function(e){return{id:p.w5[e].networkVersion,title:p.w5[e].chainName}}));e.unshift({id:0,title:"Select Blockchain"})}(),function(e){var n=(0,q.n)(),t=n.storageChainId,o=n.storageAddress,c=e.storageData,d=(e.storageIsLoading,e.isOwner),u=e.openConfirmWindow,h=e.addNotify,v=e.setDoReloadStorage,x=e.setDoReloadStorageFast,g=(e.storageTexts,e.storageDesign,(0,m.useState)(!1)),j=g[0],b=g[1],y=(0,m.useState)(!1),w=y[0],k=y[1],N=(0,m.useState)(!1),C=N[0],S=N[1],I=(0,m.useState)(!1),A=I[0],R=I[1],T=function(e,n){var t=!1;try{t=e.message.replace("Internal JSON-RPC error.",""),t=JSON.parse(t)}catch(r){}switch(t&&t.message?t.message:e.message){case"execution reverted: You don't own this token!":console.log("You dont own this token");break;case"MetaMask Tx Signature: User denied transaction signature.":console.log("Transaction denied");break;case"execution reverted: ERC721: invalid token ID":console.log("Invalid token ID");break;default:console.log("Unkrnown error",e.message)}},D=function(e){b(e)},_=function(){var e=(0,r.Z)(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!w||"".concat(j)!="".concat(t)){e.next=4;break}w.eth.getAccounts().then((function(e){S(e[0]);var n=new w.eth.Contract(z.Mt,o);Z(n)})).catch((function(e){console.log(">>> initOnWeb3Ready",e),T(e)})),e.next=8;break;case 4:return e.next=6,(0,Y.IC)();case 6:e.sent&&E();case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,m.useEffect)((function(){var e;e="on useEffect activeWeb3 initOnWeb3Ready",console.log(e),_()}),[w]);var E=function(){var e=(0,r.Z)(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(0,Y.pE)({onBeforeConnect:function(){R(!0)},onSetActiveChain:b,onConnected:function(e,n){k(n),(0,Y.uK)(D),R(!1)},onError:function(e){console.log(">>>> connectWithMetamask",e),T(e),R(!1)},needChainId:t});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),L=(0,m.useState)(!1),B=L[0],Z=L[1],O=(0,m.useState)(!1),P=O[0],U=O[1],V=function(){var e=(0,r.Z)(s().mark((function e(n){var o,i,l,d,f,m,v;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=n.onBegin,i=n.onReady,l=n.onError,d=n.newData,!P){e.next=4;break}return h("Storage already saving...","error"),e.abrupt("return");case 4:f=(0,a.Z)({},c,d),console.log(">> save data",f),m=function(){var e=(0,r.Z)(s().mark((function e(){var n,t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!C||!B){e.next=19;break}return h("Saving config to storage. Confirm transaction"),U(!0),o&&o(),n=f,e.prev=5,e.next=8,(0,M.A)(C,B,"setKeyData",[(0,X.Z)(),{owner:C,info:JSON.stringify(n)}]);case 8:t=e.sent,B.methods.setKeyData((0,X.Z)(),{owner:C,info:JSON.stringify(n)}).send(t).then((function(){U(!1),x(!0),i&&i()})).catch((function(e){console.log(">>> error",e),U(!1),l&&l(e)})),e.next=17;break;case 12:e.prev=12,e.t0=e.catch(5),console.log(">>> error",e.t0),U(!1),l&&l(e.t0);case 17:e.next=20;break;case 19:h("Fail save storage. No active wallet or contract not ready yet","error");case 20:case"end":return e.stop()}}),e,null,[[5,12]])})));return function(){return e.apply(this,arguments)}}(),console.log(">> do save",(0,Y.BV)()!==t,(0,Y.BV)(),t),(0,Y.BV)(t)?m():(v=(0,p.T_)(t),u({title:"Need change active chain for save main config",message:"Please change network Storage chain (".concat(v.chainName,")"),onConfirm:(0,r.Z)(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h("Switching to Storage chain"),e.next=3,(0,Y.M5)(t);case 3:return e.next=5,Q(2e3);case 5:m();case 6:case"end":return e.stop()}}),e)}))),okLabel:"Switch"}));case 9:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),H=c&&!c.isInstalled,K=(0,m.useState)(!H),G=K[0],ee=K[1],ne=(0,m.useState)(!1),te=ne[0],re=ne[1],ae=(0,m.useState)("main"),oe=ae[0],se=ae[1],ie=(0,m.useState)((null===c||void 0===c?void 0:c.chainId)||0),ce=(ie[0],ie[1]);(0,m.useEffect)((function(){c&&ce(c.chainId)}),[c]);var le=function(){var e=(0,p.T_)(j),n=(0,p.T_)(t);return(0,i.jsxs)("div",{className:l().adminActiveChainInfo,children:[(0,i.jsxs)("span",{children:["Current active network is ",(0,i.jsxs)("b",{children:[(null===e||void 0===e?void 0:e.chainName)||"Unknown"," (",j,")"]})]}),(0,i.jsxs)("span",{children:["Main config storage network is ",(0,i.jsxs)("b",{children:[(null===n||void 0===n?void 0:n.chainName)||"Unknown"," (",t,")"]})]})]})},de={setDoReloadStorage:v,saveStorageConfig:V,openConfirmWindow:u,addNotify:h,getActiveChain:function(){return{activeAccount:C,activeChainId:j,activeWeb3:w}},storageChainId:t,storageData:c,getStorageData:function(){return c}},ue=new F(de),he=new W(de),fe=new J(de);return G&&(H=!1),(0,i.jsxs)("div",{className:l().container,children:[f("settings",!0),(0,i.jsx)("h1",{className:l().h1,children:"Settings"}),null!==c&&(0,i.jsx)(i.Fragment,{children:H?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("h2",{children:"Application need setup on this domain"}),C?(0,i.jsxs)(i.Fragment,{children:[le(),(0,i.jsx)("button",{disabled:te,className:"".concat(l().mainButton," ").concat(l().autoWidth," primaryButton"),onClick:function(){V({onBegin:function(){re(!0),h("Confirm transaction for setup Lottery on this domain")},onReady:(0,r.Z)(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:re(!1),ee(!0),h("Lottery successfull installed on this domain. Now you can configure farm","success"),v(!0);case 4:case"end":return e.stop()}}),e)}))),onError:function(e){re(!1),h("Fail setup Lottery on domain","error")},newData:{isInstalled:!0}})},children:te?"Setup on domain...":"Setup Lottery on this domain"})]}):(0,i.jsx)("button",{disabled:A,className:"".concat(l().mainButton," primaryButton"),onClick:E,children:A?"Connecting":"Connect Wallet"})]}):(0,i.jsx)(i.Fragment,{children:C?(0,i.jsx)(i.Fragment,{children:d?(0,i.jsxs)(i.Fragment,{children:[le(),(0,i.jsx)("ul",{className:l().settingsTabsNav,children:Object.keys($).map((function(e){return(0,i.jsx)("li",{onClick:function(){se(e)},className:e===oe?l().activeTab:"",children:$[e]},e)}))}),(0,i.jsx)("hr",{className:"".concat(l().divider," ").concat(l().spacerTop)}),"main"===oe&&ue.render(),"gamerules"===oe&&he.render(),"rounds"===oe&&fe.render()]}):(0,i.jsx)("h2",{children:"Access denied"})}):(0,i.jsx)("button",{disabled:A,className:"".concat(l().mainButton," primaryButton"),onClick:E,children:A?"Connecting":"Connect Wallet"})})})]})})}},function(e){e.O(0,[976,810,774,888,179],(function(){return n=52837,e(e.s=n);var n}));var n=e.O();_N_E=n}]);